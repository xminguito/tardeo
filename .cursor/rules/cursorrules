# Interactiv4 Development Guidelines

## Code Philosophy

### 1. Fail Fast, Fail Loud
- Let errors bubble up naturally - don't hide them
- Visible errors are better than silent failures
- If something is misconfigured, it should break loudly during development

### 2. Avoid Over-Engineering
- No unnecessary if/else conditions
- No defensive try/catch blocks "just in case"
- No method_exists checks on properly configured objects
- No complex conditional logging

### 3. Keep It Simple (KISS)
- Write the simplest code that works
- Shorter, clearer code is better
- Every line should have a purpose
- If you can't explain why a line exists, remove it

## Specific Guidelines

### ❌ BAD - Over-Engineered Code
```php
// DON'T DO THIS
$featureEnabled = false;
if ($viewModelFqn) {
    try {
        $vm = $viewModels->require($viewModelFqn);
        if (\method_exists($vm, 'isEnabled')) {
            $featureEnabled = $vm->isEnabled();
        }
    } catch (\Throwable $e) {
        if (isset($block) && \method_exists($block, 'getLogger')) {
            $block->getLogger()->error($e->getMessage());
        }
    }
}
if (!$featureEnabled) {
    return;
}
```

### ✅ GOOD - Simple and Clear
```php
// DO THIS INSTEAD
if ($viewModelFqn) {
    $vm = $viewModels->require($viewModelFqn);
    if (!$vm->isEnabled()) {
        return;
    }
}
```

### Exception Handling Rules
- **Only catch exceptions you can actually handle**
- Don't catch `\Throwable` or `\Exception` generically
- Let uncaught exceptions bubble up - they'll show in logs
- If you catch an exception, do something meaningful with it

```php
// ❌ BAD - Catches everything and does nothing useful
try {
    $result = $service->process();
} catch (\Throwable $e) {
    $logger->error($e->getMessage());
    return null; // Silent failure
}

// ✅ GOOD - Let it fail if it's going to fail
$result = $service->process();

// ✅ ALSO GOOD - Only catch specific expected exceptions
try {
    $result = $service->process();
} catch (ServiceUnavailableException $e) {
    // We expect this might happen and have a fallback
    $result = $this->getFallbackData();
}
```

### Defensive Programming - When NOT to Use It
```php
// ❌ BAD - Paranoid checking
if (isset($object) && \method_exists($object, 'getData') && $object->getData() !== null) {
    $data = $object->getData();
}

// ✅ GOOD - Trust your configuration
$data = $object->getData();

// ❌ BAD - Checking if method exists on configured dependency
if (\method_exists($viewModel, 'getBalance')) {
    $balance = $viewModel->getBalance();
}

// ✅ GOOD - If configured correctly, it will have the method
$balance = $viewModel->getBalance();
```

## Magento/Hyva Specific

### Working with Section Data
- Follow Hyva best practices: https://docs.hyva.io/hyva-themes/writing-code/working-with-sectiondata.html
- Listen to `private-content-loaded` event instead of manually reloading sections
- Don't dispatch `reload-customer-section-data` unless absolutely necessary
- Section data is automatically loaded on page load - use it

```php
// ✅ GOOD - Alpine.js component listening to Hyva events
return {
    receiveCustomerData(event) {
        if (event.detail?.data?.loyalty) {
            this.updateData(event.detail.data.loyalty);
        }
    }
}
```

```html
<!-- ✅ GOOD - Template listening to private-content-loaded -->
<div x-data="initComponent()"
     @private-content-loaded.window="receiveCustomerData($event)">
</div>
```

### View Models
- If a ViewModel is configured in layout XML, trust it exists
- Don't check if methods exist - if misconfigured, let it error
- Let Magento's DI container handle dependencies

## AI-Generated Code Review Checklist

Before committing AI-generated code, check:
- [ ] No unnecessary try/catch blocks
- [ ] No defensive method_exists or isset checks
- [ ] No silent failures (logging and continuing)
- [ ] Code is as simple as possible
- [ ] Every line has a clear purpose
- [ ] You understand every line fully

locally pnpm run dev

## Remember

> "Yes, we are using AI tools, but you must always check every line of code yourself. 
> Make sure you understand it fully. Avoid over-engineering with unnecessary if/else 
> or try/catch blocks - sometimes it's better to let an error happen than to silently 
> fail without notice." - Tech Lead

---



